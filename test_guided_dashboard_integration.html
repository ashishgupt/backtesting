<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guided Dashboard Walk-Forward Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f7fa; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .button { background: #4f46e5; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .button:hover { background: #3730a3; }
        .log-output { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 10px 0; }
        .status { padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Guided Dashboard Walk-Forward Validation Test</h1>
        
        <div class="test-section">
            <h2>Test Controller</h2>
            <button class="button" onclick="testWalkForwardFunction()">1. Test Walk-Forward Function</button>
            <button class="button" onclick="testGuidedDashboardAPI()">2. Test API Integration</button>
            <button class="button" onclick="clearLogs()">Clear Logs</button>
        </div>

        <div class="test-section">
            <h2>Test Results</h2>
            <div id="testStatus"></div>
        </div>

        <div class="test-section">
            <h2>Console Logs</h2>
            <div id="consoleOutput" class="log-output"></div>
        </div>
    </div>

    <script>
        // Capture console output
        const originalLog = console.log;
        const originalError = console.error;
        let logs = [];

        function captureLog(level, args) {
            const timestamp = new Date().toTimeString().split(' ')[0];
            const message = `[${timestamp}] ${level.toUpperCase()}: ${Array.from(args).join(' ')}`;
            logs.push(message);
            updateConsoleDisplay();
        }

        console.log = function(...args) {
            captureLog('info', args);
            originalLog.apply(console, args);
        };

        console.error = function(...args) {
            captureLog('error', args);
            originalError.apply(console, args);
        };

        function updateConsoleDisplay() {
            document.getElementById('consoleOutput').innerHTML = logs.join('<br>');
        }

        function setStatus(message, type = 'info') {
            document.getElementById('testStatus').innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearLogs() {
            logs = [];
            updateConsoleDisplay();
            setStatus('Logs cleared', 'info');
        }

        // Simulate the userData object
        const userData = {
            selectedProfile: 'balanced'
        };

        // Test functions from guided dashboard
        function generateWalkForwardResults(strategy) {
            console.log('generateWalkForwardResults called with strategy:', strategy);
            const baseMetrics = {
                'conservative': { windows: 47, consistency: 89, degradation: 1.8 },
                'balanced': { windows: 52, consistency: 85, degradation: 2.3 },
                'aggressive': { windows: 49, consistency: 82, degradation: 2.9 }
            };
            
            const result = baseMetrics[strategy] || baseMetrics['balanced'];
            console.log('Generated walk-forward data:', JSON.stringify(result, null, 2));
            return result;
        }

        // Test the walk-forward function
        async function testWalkForwardFunction() {
            console.log('=== Testing Walk-Forward Function ===');
            setStatus('Testing walk-forward validation function...', 'info');
            
            try {
                // Test data generation
                const testData = generateWalkForwardResults('balanced');
                console.log('‚úÖ Data generation successful');
                
                // Test with different profiles
                const conservativeData = generateWalkForwardResults('conservative');
                const aggressiveData = generateWalkForwardResults('aggressive');
                
                console.log('Conservative data:', JSON.stringify(conservativeData, null, 2));
                console.log('Aggressive data:', JSON.stringify(aggressiveData, null, 2));
                
                setStatus('‚úÖ Walk-forward function test passed!', 'success');
                
            } catch (error) {
                console.error('‚ùå Walk-forward function test failed:', error);
                setStatus(`‚ùå Function test failed: ${error.message}`, 'error');
            }
        }

        // Test API integration
        async function testGuidedDashboardAPI() {
            console.log('=== Testing API Integration ===');
            setStatus('Testing API integration...', 'info');
            
            try {
                // Test if server is accessible
                console.log('Checking server accessibility...');
                const response = await fetch('http://localhost:8007/guided-dashboard.html');
                
                if (response.ok) {
                    console.log('‚úÖ Server is accessible');
                    
                    // Test optimization API with correct endpoint
                    console.log('Testing optimization API...');
                    const optimizationResponse = await fetch('http://localhost:8007/api/enhanced/portfolio/optimize', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            risk_level: 'balanced',
                            target_amount: 50000,
                            time_horizon: 10
                        })
                    });
                    
                    if (optimizationResponse.ok) {
                        const data = await optimizationResponse.json();
                        console.log('‚úÖ Optimization API working');
                        console.log('Sample API response:', JSON.stringify(data, null, 2));
                        setStatus('‚úÖ API integration test passed!', 'success');
                    } else {
                        throw new Error(`Optimization API failed: ${optimizationResponse.status}`);
                    }
                    
                } else {
                    throw new Error(`Server not accessible: ${response.status}`);
                }
                
            } catch (error) {
                console.error('‚ùå API integration test failed:', error);
                setStatus(`‚ùå API test failed: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            console.log('üß™ Walk-Forward Validation Test Suite Initialized');
            setStatus('Test suite ready - click buttons above to run tests', 'info');
        };
    </script>
</body>
</html>